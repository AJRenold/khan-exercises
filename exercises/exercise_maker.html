<!DOCTYPE html>
<head>

	<meta charset="UTF-8" />
	<title>Exercise maker</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>
	<script>
		var variables = [];
		function Variable( text, name ){
			this.text = text;
			this.name = name;
			this.toJs = function() {
				return this.text;
			}	
		}
		variables.push( new Variable ( "randRange(-9, 9)" , "H" ) );
		variables.push( new Variable ( "randRange(-9, 9)" , "K" ) );
		variables.push( new Variable ( "randRange(1, 7)" , "R" ) );
		variables.push( new Variable ( ' expr(["^", ["+", "x", -H], 2])' , "X2T" ) );
		variables.push( new Variable ( 'expr(["^", ["+", "y", -K], 2])' , "Y2T" ) );
		function genVars( vars ){
			toReturn = '<div class="vars">'; 
			for( x = 0; x< vars.length; x++ ) {
				toReturn += '<var id = "' + vars[x].name + '">' + vars[x].toJs()+ '</var>';
			}
			toReturn += '</div>';
			return toReturn;
		}
		
		function genQuestion( text ) {
			
			return '<div class="question">' + text + '</div>';
	
		}
		function addVariable( span ){
			
		}
		function populateQuestion(){
			var input = $("#question").val();
			var inputArray = input.split(" ");
			var toReturn = "";
			var openVar = false
			for( x = 0; x< inputArray.length; x++ ) {
				if(inputArray[x].substring(0,5) == "</var"){
					openVar = false; 
					toReturn += inputArray[x];
				}
				else if( openVar || inputArray[x].substring(0,5) == "<var>"){
					openVar = true;
					toReturn += inputArray[x];
				}
				else {
					toReturn += "<span id='q" + x +  "' onClick='addVariable(this)' > " + inputArray[x] + "</span>";
				}
			}
			$("#questionInput").html( toReturn );
			return; 
		}
		function genHead( title ){
			var head = '' +  
				'<!DOCTYPE html>' +
				'<html data-require="math math-format expressions">' +
				'<head>' +
				'	<meta charset="UTF-8" />' +
				'       <title>' + title + '</title>' +
				'       <script src="../khan-exercise.js"></script\> ' +
				'</head>' ; 
			return head;
		}
		function generate(){
			populateQuestion();
		var html =  genHead($("#title").val()) + '<body><div class="exercise">' + genVars( variables ) + 
'' +
'	<div class="problems">' +
'		<div>' + genQuestion( $("#questionInput").html()) + 
'' +
'			<div class="solution" data-type="multiple">' +
'				<p class="short"><code>(h, k) = (</code><span class="sol"><var>H</var></span><code>,</code> <span class="sol"><var>K</var></span><code>)</code></p>' +
'				<p><code>r</code> = <span class="sol"><var>R</var></span></p>' +
'				<div><input type="button" value="Increase slope" "></div>' +
'			</div>' +
'		</div>' +
'	</div>' +
'' +
'	<div class="hints">' +
'		<p>The equation of a circle with center <code>(h, k)</code> and radius <code>r</code> is <code>(x - h)^2 + (y - k)^2 = r^2</code>.</p>' +
'		<p>We can rewrite the given equation as <code>(x - <var>negParens(H)</var>)^2 + (y - <var>negParens(K)</var>)^2 = <var>R</var>^2</code>.</p>' +
'		<p>Thus, <code>(h, k) = (<var>H</var>, <var>K</var>)</code> and <code>r = <var>R</var></code>.</p>' +
'	</div>' +
'	</div>' +
'</body>' +
'</html>';
	$("#frame").remove();	
        var $frame = $('<iframe id="frame" style="width:800px; height:600px;">'); 
        $('body').append( $frame ); 

		setTimeout( function() { 
		var ifrm = document.getElementById('frame');
		ifrm = (ifrm.contentWindow) ? ifrm.contentWindow : (ifrm.contentDocument.document) ? ifrm.contentDocument.document : ifrm.contentDocument;
		ifrm.document.open();
		ifrm.document.write(html);
		ifrm.document.close();
 
        }, 1 ); 
}
</script>
<body onload='generate()'>

	<input id="title">
	<br>
	<textarea id="question" rows = "4" columns = "400"  type="text"></textarea>
	<br>
	<div id = "questionInput">
	</div>
	<input type="button" value="Generate" onClick="generate();">
	<div id="fr">
	</div>
</body>
</html>
